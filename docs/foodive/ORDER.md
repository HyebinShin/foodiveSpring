### Order | OrderDetail

### 프로젝트를 위한 요구사항
> * 고객은 새로운 주문을 할 수 있다.
> * 고객은 기존 주문 내역을 확인할 수 있다.
> * 관리자는 (특정|모든) 고객의 주문을 확인할 수 있다.
> * 관리자는 특정 고객의 주문 상태를 변경할 수 있다.

### 요구사항에 따른 화면 설계
> * 주문서 작성 -> 주문하기
> * 고객: 주문 내역 확인 | 단일 주문 확인
> * 관리자: 모든 고객의 주문 목록 확인 | 단일 주문 확인 | 주문 상태 변경

### 주문 테이블 설계 : `tbl_order`
> * 주문 번호 : ono
> * 고객 아이디 : id
> * 총 주문 금액 : totalPrice
> * 주문 날짜 : orderDate

### 주문 상세 테이블 설계 : `tbl_odetail`
> * 주문 상세 번호 : dno
> * 주문 번호 : ono
> * 상품 번호 : pno
> * 상품명 : korName
> * 상품 개수 : qty
> * 총액 : totalPrice

### 배송 테이블 설계 : `tbl_ship`
> * 배송 번호 : sno
> * 주문 번호 : ono
> * 배송 수신인 : name
> * 배송 우편번호 : zipcode
> * 배송 주소 : address
> * 배송 연락처 : phone

### 결제 테이블 설계 : `tbl_pay`
> * 결제 번호 : payNo
> * 주문 번호 : ono
> * 결제 방법 : payment
> * 결제 상태 : state
> * 결제 날짜 : payDate

### 주문 기능 설계
| 완료     | 기능                                             |세부기능|
|--------|------------------------------------------------|------|
|☑️| 주문서 이동 | 장바구니 페이지에서 선택 주문 또는 전체 주문 버튼을 클릭하면 주문서 페이지로 이동한다. |
|☑️| 주문서 작성 | 고객은 주문서를 작성할 수 있다.                             |
|☑️|주문서 유효성 검사| 배송 수신인, 배송지 우편번호, 주소, 연락처 입력값의 유효성을 검사한다.      |
|☑️|주문 DB 등록| 주문 테이블, 주문 상세 테이블, 배송 테이블에 주문 내역을 등록할 수 있다.    |
|☑️|주문 내역| 주문 내역을 기간 단위 별로 출력할 수 있다.                      |
|☑️|주문 내역|특정 주문을 클릭하면 해당 주문의 상세 내역이 출력된다.|
|☑️|주문 관리|관리자는 결제 상태와 주문 기간 단위 별로 주문 목록을 볼 수 있다.|
|☑️|주문 관리|관리자는 특정 주문의 상태를 변경할 수 있다.|

### 주문 진도표
| 완료                  |상세 진도| 날짜       |
|---------------------|-------|----------|
|☑️| Mapper 작성 및 테스트     | 22.12.04 |
|☑️| Service 작성 및 테스트    | 22.12.05 |
|☑️| Controller 작성 및 테스트 | 22.12.07 |


### 22.12.05
1. [x] 장바구니 페이지에서 주문하기, 혹은 상품 페이지에서 바로 주문 버튼 클릭시 주문서 작성 페이지로 이동한다.
2. [x] 상품 목록을 Session 에 담아 전송한다.
3. [x] 이때 전송하는 데이터는 상품 번호`pno`, 상품명`korName`, 상품수량`qty`, 상품별 총액`totalPrice`, 실제 판매가`realPrice`, 상품재고`stock`이다.
4. [x] 주문서 페이지에서 유효성 검사를 모두 마친 뒤 컨트롤러로 전송하는 데이터는 다음과 같다.
> * order : id(loginInfo.id), totalPrice(총 금액)
> * detailList : OrderDetailVO 의 배열[] 형태 -- pno, korName, qty, totalPrice, stock
> * ship : name, zipcode, address, phone
> * pay : payment

5. [x] 주문을 완료한 후 상품의 재고를 해당 주문 수량만큼 뺀다.
6. [x] 만약 상품의 재고가 0이 되면, 해당 상품을 품절 처리(`state = 2`)를 한다.

7. [x] 주문을 완료한 후 주문 상품 목록을 장바구니에서 제거한다.

8. [x] 주문서 페이지 유효성 검사
> * name : 한글/영어/숫자 3자 이상 15자 이하
> * phone : 010|1 - 0000 - 0000
> * address2 : 70자 이내로 작성

9. [x] 주문서 페이지의 주소 `address`
> * `address1`과 `address2`를 콤마`,`로 합친다.

### 22.12.06
1. [x] 고객은 주문 완료 후 주문 내역 페이지로 이동한다.
2. 고객의 주문 내역 페이지는 다음과 같다.
> * [x] 기간 단위 별로 출력이 된다. : 7일 | 14일 | 30일
> * [x] 추가 버튼을 클릭하면 해당 기간 단위가 추가된다.
> * [x] 이떄 출력되는 항목은 다음과 같다.
> > * order: 주문 번호`ono`, 주문날짜`orderDate`, 주문금액`totalPrice`
>
> * [x] 특정 주문 번호 행을 클릭하면 주문 상세 내역이 나온다.
> * [x] `배송정보`를 클릭하면 배송 내역이 나온다.
> * [x] `결제정보`를 클릭하면 결제 내역이 나온다.

3. [x] [수정] OrderMapper.xml
> * datePage 의 필드로 고객의 아이디`id` 포함 (고객이 본인의 내역을 보기 위해서)

4. 관리자의 주문 내역 페이지는 다음과 같다.
> * [x] 기간 단위와 주문 상태 별로 출력이 된다. // 결제 대기 : 0, 주문 접수 : 1, 배송 중 : 2, 배송 완료 : 3, 주문 취소: 4
> * [x] 이때 출력되는 정보는 다음과 같다.
> > * order: 주문 번호 `ono`, 주문자 아이디`id`, 주문 날짜`orderDate`, 주문금액`totalPrice`, 주문상태`state`
> * [x] 페이징 처리가 되어 있다. (1, 2, 3, 4...)
> * [x] 기간 단위
> > * 기간 단위에서 다음 버튼을 누르면 기간 단위만큼 추가된다.
> > * 기간 단위에서 이전 버튼을 누르면 기간 단위만큼 감소된다.
> > * 기간 단위가 0이 될 수는 없다. = 1이상?
> 
> * [x] 페이징
> > * 1, 2, 3 ...을 누르면 해당 페이지의 목록이 출력된다.
> > * 단, 이때 기간 단위의 변화는 없어야 한다.
> 
> * [x] 특정 주문 번호 행을 클릭하면 주문 상세 내역이 나온다.
> * `배송 정보`를 클릭하면 배송 내역이 나온다.
> * `결제 정보`를 클릭하면 결제 내역이 나온다.
> * [x] 관리자는 배송 정보와 결제 정보를 수정할 수 있다.
> * 수정 가능한 정보는 다음과 같다.
> > * 배송 : 배송 수신인, 배송지 우편번호, 배송지 주소, 연락처
> > * 결제 : 결제 상태 // 0: 무통장 입금 전 , 1: 결제 완료, 2: 결제 취소

5. [x] [수정] ShipVO 변경
> * address -> address1 (기본주소), address2 (상세주소)

### 22.12.07
1. [x] 관리자가 결제 상태를 변경하면 주문 상태도 변경되어야 한다.
> * 결제 상태 0 -> 1 : 주문 상태 0 -> 1
> * 결제 상태 2로 변경 : 주문상태 4로 변경

2. [x] 관리자는 주문 상태를 변경할 수 있다.
> * 단, 결제 상태가 1일 때만 주문 상태를 1, 2 혹은 3으로 변경할 수 있다.
> * 결제 상태가 2일 때만 주문 상태를 4로 변경할 수 있다.
> * 결제 상태가 0일 때는 주문 상태는 0으로 유지되어야 한다.

3. [x] 위 1, 2번 사항은 자바에서도 검증되어야 한다.